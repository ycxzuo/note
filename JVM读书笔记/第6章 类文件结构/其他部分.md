# 公有设计和私有实现

Java 虚拟机规范描绘了 Java 虚拟机应有的共同程序存储格式：**Class 文件格式**以及**字节码指令集**。这些内容与硬件、操作系统及具体的 Java 虚拟机实现之间是完全独立的。

Java 虚拟机必须能够读取 Class 文件并精准实现包含在其中的 Java 虚拟机代码的语义。优秀的虚拟机实现，在满足虚拟机规范的约束下对具体实现作出修改和优化也是完全可行的，并且虚拟机规范中明确鼓励实现者这样做。只要优化后 Class 文件依然可以被正确读取，并且包含在其中的语义能够得到完整的保持，那实现者就可以选择任何方式去实现这些语义，虚拟机后台如何处理 Class 文件完全是实现者自己的事情，只要它在外部接口上看起来与规范描述一致即可。

虚拟机实现者可以使用这种**伸缩性**来让 Java 虚拟机获得**更高的性能、更低的内存消耗或者更好的可移植性**，选择哪种特性取决于 Java 虚拟机实现的目标和关注点是什么。虚拟机实现的方式主要有

* 将输入的 Java 虚拟机代码在加载或执行时翻译成**另外一种虚拟机的指令集**
* 将输入的 Java 虚拟机代码在加载或执行时翻译成**宿主机 CPU 的本地指令集（即`JIT`代码生成技术）**

精确定义的虚拟机和目标文件格式不应当对虚拟机实现者的创造性产生太多的限制，Java 虚拟机应被设计成可以允许有众多不同的实现，并且各种实现可以在保持兼容性的同时提供不同的、新的、有趣的解决方案



# 本章小结

Class 文件是 Java 虚拟机执行引擎的数据入口，也是 Java 技术体系的基础构成之一。本章讲解了 Class 文件结构中的各个组成部分，以及每个部分的定义、数据结构和使用方法。