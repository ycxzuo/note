# Volatile 关键字

## 概念

volatile 是比 synchronized 关键字同步机制更弱一点的同步关键字，它只能修饰变量



## 特性

* 保证变量对所有线程可见
* 禁止指令重排



## MESI 一致性协议

MESI 是指 4 中状态的首字母。每个 Cache line 有 4 个状态，可用 2 个 bit 表示

* M -> Modified
  * 当前 CPU 刚修改完数据的状态，当前 CPU 拥有最新数据，其他 CPU 拥有失效数据，而且和主存数据不一致
* E -> Exclusive
  * 只有当前 CPU 中有数据，其他 CPU 中没有改数据，当前 CPU 的数据和主存的数据是一致的
* S -> Shared
  * 当前 CPU 和其他 CPU 中都有共同的数据，并且和主存中的数据一致
* I -> Invalid
  * 当前 CPU 中的数据失效，数据应该从主存中获取，其他 CPU 中可能有数据也可能无数据，当前 CPU 中的数据和主存中的数据被认为不一致



## 功能





## 使用场景

* 对变量的写操作不依赖当前值
* 不同的 volatile 变量不能互相依赖